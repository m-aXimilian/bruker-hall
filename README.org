#+startup: indent
#+title: Bruker Hall measurements
#+subtitle: using fmr-py as submodule

* Description
Controlled ramping of a B-field function and measuring
Lockin-Amplifier parameters. Can be used for *Hall-effect* and *MR*
measurements.

** H-Field Ramp
The waveform for the ramp is generated automatically by means of the
parameters (start, stop, increment, etc.) in [[file:config/measurement.yaml][measurement config]] file.
Based on this wave 2 set-values are generated for
1. the xantrex power supply and
2. the PID-controller.
The first is taken from a fit-function (see figure [[fit-fuctions]]) based
on B-field measurements for different power supply voltages.

#+BEGIN_QUOTE
The fit-function is generated from the data provided in ``B-field-lookup.yaml''. The order of the fit-function can be passed by setting the ~deg~ parameter.
If not provided, a fit of the first order is calculated.
#+END_QUOTE

#+name: fit-fuctions
#+html: <p align="center"><img src="doc/field-set-functions_many-points.png" width="60%"></p>
The PID-controller value is just a scaled value based on the ramp
wave.
See figure [[ramp-set]]  for an example for a triangular shaped ramp from 0 to 1T
#+name: ramp-set
#+html: <p align="center"><img src="doc/field-set-voltages_0-1T-ramp_many-points.png" width="60%"></p>


** Measurement
The SR8320 sources a sinus voltage, which generates a ``constant''
current by means of a high resistance (kÎ©). The input is locked in at
the source frequency. For every value in of the waveform array
- the respective B-field is set,
- the process waits until the B-field is within the boundary
  ``delta-start'' configured in [[file:config/measurement.yaml][measurement config]]
- a number of N measurements is recorded and written to a file

* Usage
  #+begin_src sh
  git clone --recurse-submodules https://gitlab.lrz.de/m-aximilian/bruker-hall.git
  cd bruker-hall
  #+end_src

* Notes and Parameters

** Parameters
- Hall Sensor: 1V := 100mT
- Xantrex voltage range: 0-150V
  
* Hardware
- 2T Bruker Magnet
- [[https://www.manualslib.com/manual/633965/Xantrex-Xfr-6-200.html#product-XFR%20150-8][xantrex XFR 150-8]]
- [[https://www.thinksrs.com/downloads/pdfs/manuals/SR830m.pdf][Stanford Research SR830 Lockin Amplifier]]
- Audio Amplifier with PID-controller

* Tests 
** Up to 500mT ramp -- 2022/02/04

#+name: parameters-500mt
| zero        | 0        |
| amp         | 500      |
| N           | 2000     |
| delta-fine  | 10       |
| delta-start | 1        |
| real-inc    | 0.5      |
| max-inc     | 5        |
| wait-b      | 0.5      |
| timeout     | 20       |

No issues on rampup. 
On rampdown, the PID current was contantly in the order of 3 to 4A.

** Up to 100mT ramp -- 2022/02/08

#+name: parameters-100mT
#+name: parameters-500mt
| zero        | 0        |
| amp         | 100      |
| N           | 10000     |
| delta-fine  | 10       |
| delta-start | 1        |
| real-inc    | 0.02      |
| max-inc     | 5        |
| wait-b      | 0.5      |
| timeout     | 20       |

No issues! Auxilary current below 1A for the whole time and no timeout!


